import{h as D,a4 as P,at as M,t as C,a9 as Y,aa as E,au as J,i as N,a as o,x as F,aj as W,aq as j,I as H,H as Z,an as Q,A as ee,G as $,n as ne,am as oe,r as O,J as G,av as te,k as ae,aw as R,ax as se,X as L,ay as le,az as ce,aA as U,aB as re,E as ie,aC as de,aD as ue,aE as me,_ as fe,b as _e,S as ge,o as T,c as K,f as V,Y as ve,Z as pe,w as he,a1 as q,N as be,V as Be}from"./index-786b1c77.js";import{S as Ce}from"./index-6230a108.js";import"./index-2de2f4d6.js";import{F as we}from"./index-9ab1ad7c.js";import"./index-ea81e4d8.js";import{C as ye}from"./index-5d01f35b.js";import"./index-0611bba7.js";import"./index-34579d66.js";import"./index-6e9a7553.js";import{A as ke}from"./index-b2e1e4b1.js";import{c as z}from"./order-71bb01b0.js";import"./use-id-75d822c1.js";const[xe,f]=D("action-sheet"),Se=P({},M,{title:String,round:C,actions:Y(),closeIcon:E("cross"),closeable:C,cancelText:String,description:String,closeOnPopstate:C,closeOnClickAction:Boolean,safeAreaInsetBottom:C}),Pe=[...J,"round","closeOnPopstate","safeAreaInsetBottom"];var Ie=N({name:xe,props:Se,emits:["select","cancel","update:show"],setup(e,{slots:s,emit:a}){const u=l=>a("update:show",l),t=()=>{u(!1),a("cancel")},_=()=>{if(e.title)return o("div",{class:f("header")},[e.title,e.closeable&&o(H,{name:e.closeIcon,class:[f("close"),Z],onClick:t},null)])},y=()=>{if(s.cancel||e.cancelText)return[o("div",{class:f("gap")},null),o("button",{type:"button",class:f("cancel"),onClick:t},[s.cancel?s.cancel():e.cancelText])]},k=l=>{if(l.icon)return o(H,{class:f("item-icon"),name:l.icon},null)},b=(l,B)=>l.loading?o(Q,{class:f("loading-icon")},null):s.action?s.action({action:l,index:B}):[o("span",{class:f("name")},[l.name]),l.subname&&o("div",{class:f("subname")},[l.subname])],w=(l,B)=>{const{color:r,loading:i,callback:v,disabled:d,className:n}=l,c=()=>{d||i||(v&&v(l),e.closeOnClickAction&&u(!1),ee(()=>a("select",l,B)))};return o("button",{type:"button",style:{color:r},class:[f("item",{loading:i,disabled:d}),n],onClick:c},[k(l),b(l,B)])},S=()=>{if(e.description||s.description){const l=s.description?s.description():e.description;return o("div",{class:f("description")},[l])}};return()=>o(j,F({class:f(),position:"bottom","onUpdate:show":u},W(e,Pe)),{default:()=>{var l;return[_(),S(),o("div",{class:f("content")},[e.actions.map(w),(l=s.default)==null?void 0:l.call(s)]),y()]}})}});const Oe=$(Ie),[Te,g,I]=D("dialog"),Ae=P({},M,{title:String,theme:String,width:ne,message:[String,Function],callback:Function,allowHtml:Boolean,className:oe,transition:E("van-dialog-bounce"),messageAlign:String,closeOnPopstate:C,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:C,closeOnClickOverlay:Boolean,keyboardEnabled:C,destroyOnClose:Boolean}),De=[...J,"transition","closeOnPopstate","destroyOnClose"];var X=N({name:Te,props:Ae,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:s,slots:a}){const u=O(),t=G({confirm:!1,cancel:!1}),_=n=>s("update:show",n),y=n=>{var c;_(!1),(c=e.callback)==null||c.call(e,n)},k=n=>()=>{e.show&&(s(n),e.beforeClose?(t[n]=!0,ie(e.beforeClose,{args:[n],done(){y(n),t[n]=!1},canceled(){t[n]=!1}})):y(n))},b=k("cancel"),w=k("confirm"),S=te(n=>{var c,p;if(!e.keyboardEnabled||n.target!==((p=(c=u.value)==null?void 0:c.popupRef)==null?void 0:p.value))return;({Enter:e.showConfirmButton?w:R,Escape:e.showCancelButton?b:R})[n.key](),s("keydown",n)},["enter","esc"]),l=()=>{const n=a.title?a.title():e.title;if(n)return o("div",{class:g("header",{isolated:!e.message&&!a.default})},[n])},B=n=>{const{message:c,allowHtml:p,messageAlign:h}=e,x=g("message",{"has-title":n,[h]:h}),m=se(c)?c():c;return p&&typeof m=="string"?o("div",{class:x,innerHTML:m},null):o("div",{class:x},[m])},r=()=>{if(a.default)return o("div",{class:g("content")},[a.default()]);const{title:n,message:c,allowHtml:p}=e;if(c){const h=!!(n||a.title);return o("div",{key:p?1:0,class:g("content",{isolated:!h})},[B(h)])}},i=()=>o("div",{class:[ce,g("footer")]},[e.showCancelButton&&o(L,{size:"large",text:e.cancelButtonText||I("cancel"),class:g("cancel"),style:{color:e.cancelButtonColor},loading:t.cancel,disabled:e.cancelButtonDisabled,onClick:b},null),e.showConfirmButton&&o(L,{size:"large",text:e.confirmButtonText||I("confirm"),class:[g("confirm"),{[le]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:t.confirm,disabled:e.confirmButtonDisabled,onClick:w},null)]),v=()=>o(re,{class:g("footer")},{default:()=>[e.showCancelButton&&o(U,{type:"warning",text:e.cancelButtonText||I("cancel"),class:g("cancel"),color:e.cancelButtonColor,loading:t.cancel,disabled:e.cancelButtonDisabled,onClick:b},null),e.showConfirmButton&&o(U,{type:"danger",text:e.confirmButtonText||I("confirm"),class:g("confirm"),color:e.confirmButtonColor,loading:t.confirm,disabled:e.confirmButtonDisabled,onClick:w},null)]}),d=()=>a.footer?a.footer():e.theme==="round-button"?v():i();return()=>{const{width:n,title:c,theme:p,message:h,className:x}=e;return o(j,F({ref:u,role:"dialog",class:[g([p]),x],style:{width:ae(n)},tabindex:0,"aria-labelledby":c||h,onKeydown:S,"onUpdate:show":_},W(e,De)),{default:()=>[l(),r(),d()]})}}});let A;const Ee={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1,destroyOnClose:!1};let Ne=P({},Ee);function Fe(){({instance:A}=ue({setup(){const{state:s,toggle:a}=me();return()=>o(X,F(s,{"onUpdate:show":a}),null)}}))}function $e(e){return de?new Promise((s,a)=>{A||Fe(),A.open(P({},Ne,e,{callback:u=>{(u==="confirm"?s:a)(u)}}))}):Promise.resolve(void 0)}const He=e=>$e(P({showCancelButton:!0},e));$(X);const[Re,Le]=D("divider"),Ue={dashed:Boolean,hairline:C,vertical:Boolean,contentPosition:E("center")};var Ke=N({name:Re,props:Ue,setup(e,{slots:s}){return()=>{var a;return o("div",{role:"separator",class:Le({dashed:e.dashed,hairline:e.hairline,vertical:e.vertical,[`content-${e.contentPosition}`]:!!s.default&&!e.vertical})},[!e.vertical&&((a=s.default)==null?void 0:a.call(s))])}}});const Ve=$(Ke);const qe={class:"container"},ze={class:"address"},Me={class:"goods_list"},Je={__name:"Create",setup(e){const s=_e(),a=ge(),u=O("");s.query.orderInfo||a.replace("/cart");const t=O(JSON.parse(decodeURI(atob(s.query.orderInfo||"")||"")||"[]"));console.table("orderInfo",t.value);const _=t.value.goods.map(r=>r.cart_id).filter(r=>r);console.log("cartIds",_),console.log(_);const y=G([{id:"1",name:t.value.consignee_name,tel:t.value.consignee_phone,address:t.value.consignee_address,isDefault:t.value.isDefault}]),k=()=>{He({message:"退出生成订单?"}).then(()=>{a.replace("/order")}).catch(()=>{})},b=O(!1),w=[{name:"微信",pay_type:1},{name:"支付宝",pay_type:2},{name:"云闪付",pay_type:3}],S=async r=>{const i=t.value.goods.map(n=>({goods_id:n.goods_id,goods_options_id:n.goods_options_info.id,count:n.count,price:n.goods_options_info.price}));if(!i.length){a.replace("/order");return}console.log(i);const v={pay_type:r.pay_type,status:2,remark:u.value,price:t.value.price,consignee_name:t.value.consignee_name,consignee_phone:t.value.consignee_phone,consignee_address:t.value.consignee_address,order_goods_infos:i},d=await z(v);if(_.length){const n=await q(_);console.log(n),console.log("--------------------------------------")}console.log(d),console.log(r),a.replace("/order")},l=async()=>{const r=t.value.goods.map(d=>({goods_id:d.goods_id,goods_options_id:d.goods_options_info.id,count:d.count,price:d.goods_options_info.price}));if(!r.length){a.replace("/order");return}console.log(r);const i={pay_type:0,status:1,remark:u.value,price:t.value.price,consignee_name:t.value.consignee_name,consignee_phone:t.value.consignee_phone,consignee_address:t.value.consignee_address,order_goods_infos:r},v=await z(i);if(console.log(v),_.length){const d=await q(_);console.log(d)}a.replace("/order")},B=()=>{b.value=!0};return(r,i)=>{const v=be,d=ke,n=Ve,c=ye,p=we,h=Ce,x=Oe;return T(),K("div",qe,[o(v,{"left-arrow":"",onClickLeft:k,title:r.$route.meta.title,placeholder:"",fixed:""},null,8,["title"]),V("div",ze,[o(d,{class:"address_list",list:y,"default-tag-text":"默认",switchable:!1},null,8,["list"]),o(n,{style:{color:"#1989fa",borderColor:"#1989fa",padding:"0 0"},dashed:""})]),V("div",Me,[(T(!0),K(ve,null,pe(t.value.goods,m=>(T(),Be(c,{key:m.goods_id,num:m.count,price:(m.goods_options_info.price/100).toFixed(2),desc:m.goods_info.detail_info,title:m.goods_info.name,thumb:m.goods_info.pic_url},null,8,["num","price","desc","title","thumb"]))),128))]),o(h,{price:t.value.price,"button-text":"生成订单",onSubmit:B,placeholder:""},{top:he(()=>[o(p,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=m=>u.value=m),modelModifiers:{trim:!0},type:"textarea",label:"备注",placeholder:"备注",rows:"3",maxlength:"50","show-word-limit":"",rules:[{required:!0,message:"请填写备注"}]},null,8,["modelValue"])]),_:1},8,["price"]),o(x,{show:b.value,"onUpdate:show":i[1]||(i[1]=m=>b.value=m),actions:w,"cancel-text":"取消","close-on-click-action":"",onSelect:S,onCancel:l},null,8,["show"])])}}},sn=fe(Je,[["__scopeId","data-v-8bb96609"]]);export{sn as default};
