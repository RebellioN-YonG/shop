import{h as ie,m as M,t as U,n as R,i as ce,r as F,j as T,k as oe,l as re,p as X,q as fe,a as m,s as j,v as Q,x as ne,H as ae,y as se,z as K,A as me,C as ge,D as J,E as ue,F as _e,L as he,G as de,J as ve,K as be,M as pe,O as Ce,P as ye,Q as ke,R as Se,_ as Te,S as we,T as Ve,U as xe,d as Pe,o as y,c as z,u as Y,V as A,w as b,f as le,W as G,N as Be,X as Ee,Y as Ie,Z as $e,$ as H,a0 as Ne,a1 as Le,a2 as Me,I as Re,B as Fe}from"./index-786b1c77.js";import{S as We}from"./index-6230a108.js";import{E as De}from"./index-11af69d8.js";import{L as Ue}from"./index-fdda10ed.js";import{T as ze}from"./index-ea81e4d8.js";import{C as Ae}from"./index-5d01f35b.js";import{C as Ge}from"./index-34579d66.js";import"./index-6e9a7553.js";import"./use-id-75d822c1.js";import"./use-tab-status-ab1aea8b.js";const[He,O]=ie("stepper"),Oe=200,q=(t,g)=>String(t)===String(g),qe={min:M(1),max:M(1/0),name:M(""),step:M(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:U,showMinus:U,showInput:U,longPress:U,autoFixed:U,allowEmpty:Boolean,modelValue:R,inputWidth:R,buttonSize:R,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:M(1),decimalLength:R};var Je=ce({name:He,props:qe,emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(t,{emit:g}){const h=(e,a=!0)=>{const{min:d,max:s,allowEmpty:f,decimalLength:B}=t;return f&&e===""||(e=se(String(e),!t.integer),e=e===""?0:+e,e=Number.isNaN(e)?+d:e,e=a?Math.max(Math.min(+s,e),+d):e,K(B)&&(e=e.toFixed(+B))),e},c=()=>{var e;const a=(e=t.modelValue)!=null?e:t.defaultValue,d=h(a);return q(d,t.modelValue)||g("update:modelValue",d),d};let r;const p=F(),u=F(c()),v=T(()=>t.disabled||t.disableMinus||+u.value<=+t.min),k=T(()=>t.disabled||t.disablePlus||+u.value>=+t.max),E=T(()=>({width:oe(t.inputWidth),height:oe(t.buttonSize)})),_=T(()=>re(t.buttonSize)),n=()=>{const e=h(u.value);q(e,u.value)||(u.value=e)},o=e=>{t.beforeChange?ue(t.beforeChange,{args:[e],done(){u.value=e}}):u.value=e},l=()=>{if(r==="plus"&&k.value||r==="minus"&&v.value){g("overlimit",r);return}const e=r==="minus"?-t.step:+t.step,a=h(_e(+u.value,e));o(a),g(r)},i=e=>{const a=e.target,{value:d}=a,{decimalLength:s}=t;let f=se(String(d),!t.integer);if(K(s)&&f.includes(".")){const W=f.split(".");f=`${W[0]}.${W[1].slice(0,+s)}`}t.beforeChange?a.value=String(u.value):q(d,f)||(a.value=f);const B=f===String(+f);o(B?+f:f)},I=e=>{var a;t.disableInput?(a=p.value)==null||a.blur():g("focus",e)},w=e=>{const a=e.target,d=h(a.value,t.autoFixed);a.value=String(d),u.value=d,me(()=>{g("blur",e),ge()})};let V,C;const $=()=>{C=setTimeout(()=>{l(),$()},Oe)},N=()=>{t.longPress&&(V=!1,clearTimeout(C),C=setTimeout(()=>{V=!0,l(),$()},he))},x=e=>{t.longPress&&(clearTimeout(C),V&&J(e))},L=e=>{t.disableInput&&J(e)},P=e=>({onClick:a=>{J(a),r=e,l()},onTouchstartPassive:()=>{r=e,N()},onTouchend:x,onTouchcancel:x});return X(()=>[t.max,t.min,t.integer,t.decimalLength],n),X(()=>t.modelValue,e=>{q(e,u.value)||(u.value=h(e))}),X(u,e=>{g("update:modelValue",e),g("change",e,{name:t.name})}),fe(()=>t.modelValue),()=>m("div",{role:"group",class:O([t.theme])},[j(m("button",ne({type:"button",style:_.value,class:[O("minus",{disabled:v.value}),{[ae]:!v.value}],"aria-disabled":v.value||void 0},P("minus")),null),[[Q,t.showMinus]]),j(m("input",{ref:p,type:t.integer?"tel":"text",role:"spinbutton",class:O("input"),value:u.value,style:E.value,disabled:t.disabled,readonly:t.disableInput,inputmode:t.integer?"numeric":"decimal",placeholder:t.placeholder,autocomplete:"off","aria-valuemax":t.max,"aria-valuemin":t.min,"aria-valuenow":u.value,onBlur:w,onInput:i,onFocus:I,onMousedown:L},null),[[Q,t.showInput]]),j(m("button",ne({type:"button",style:_.value,class:[O("plus",{disabled:k.value}),{[ae]:!k.value}],"aria-disabled":k.value||void 0},P("plus")),null),[[Q,t.showPlus]])])}});const Ke=de(Je),[Xe,Z]=ie("swipe-cell"),je={name:M(""),disabled:Boolean,leftWidth:R,rightWidth:R,beforeClose:Function,stopPropagation:Boolean};var Qe=ce({name:Xe,props:je,emits:["open","close","click"],setup(t,{emit:g,slots:h}){let c,r,p,u;const v=F(),k=F(),E=F(),_=ve({offset:0,dragging:!1}),n=be(),o=e=>e.value?ke(e).width:0,l=T(()=>K(t.leftWidth)?+t.leftWidth:o(k)),i=T(()=>K(t.rightWidth)?+t.rightWidth:o(E)),I=e=>{_.offset=e==="left"?l.value:-i.value,c||(c=!0,g("open",{name:t.name,position:e}))},w=e=>{_.offset=0,c&&(c=!1,g("close",{name:t.name,position:e}))},V=e=>{const a=Math.abs(_.offset),d=.15,s=c?1-d:d,f=e==="left"?l.value:i.value;f&&a>f*s?I(e):w(e)},C=e=>{t.disabled||(p=_.offset,n.start(e))},$=e=>{if(t.disabled)return;const{deltaX:a}=n;n.move(e),n.isHorizontal()&&(r=!0,_.dragging=!0,(!c||a.value*p<0)&&J(e,t.stopPropagation),_.offset=Se(a.value+p,-i.value,l.value))},N=()=>{_.dragging&&(_.dragging=!1,V(_.offset>0?"left":"right"),setTimeout(()=>{r=!1},0))},x=(e="outside",a)=>{u||(g("click",e),c&&!r&&(u=!0,ue(t.beforeClose,{args:[{event:a,name:t.name,position:e}],done:()=>{u=!1,w(e)},canceled:()=>u=!1,error:()=>u=!1})))},L=e=>a=>{(r||c)&&a.stopPropagation(),!r&&x(e,a)},P=(e,a)=>{const d=h[e];if(d)return m("div",{ref:a,class:Z(e),onClick:L(e)},[d()])};return pe({open:I,close:w}),Ce(v,e=>x("outside",e),{eventName:"touchstart"}),ye("touchmove",$,{target:v}),()=>{var e;const a={transform:`translate3d(${_.offset}px, 0, 0)`,transitionDuration:_.dragging?"0s":".6s"};return m("div",{ref:v,class:Z(),onClick:L("cell"),onTouchstartPassive:C,onTouchend:N,onTouchcancel:N},[m("div",{class:Z("wrapper"),style:a},[P("left",k),(e=h.default)==null?void 0:e.call(h),P("right",E)])])}}});const Ye=de(Qe);const Ze={class:"container"},et={key:0,class:"content"},tt={class:"goods_box"},ot={key:1,class:"is_null"},nt={key:1,class:"no_login_content"},at={__name:"Cart",setup(t){const g=we(),h=n=>{n&&g.push({path:`/goods/${n}`})},c=Ve(),r=F(!1);xe()&&(r.value=!0),Pe(async()=>{r.value&&await c.changeCart()});const p=T({get:()=>{var n,o;return(o=(n=c.data)==null?void 0:n.every)==null?void 0:o.call(n,l=>l.checked)},set:n=>{var o,l;(l=(o=c.data).forEach)==null||l.call(o,i=>{i.checked=n})}}),u=()=>{var n,o;p.value=(o=(n=c.data)==null?void 0:n.every)==null?void 0:o.call(n,l=>l.checked)},v=T(()=>{var n;return(n=c==null?void 0:c.data)==null?void 0:n.filter(o=>o.checked).reduce((o,l)=>{var i;return o+(((i=l.goods_options_info)==null?void 0:i.price)||0)*l.count},0)}),k=async n=>{console.log(n);const o=await Le([n]);console.log(o),o.code===0&&c.changeCart()},E=async({goods_options_id:n,id:o,count:l})=>{const i=await Me({goods_options_id:n,id:o,count:l});console.log("res:",i),i.code===0&&console.log(`${o} ${n} change count ${l}`)},_=()=>{var o,l;const n=(l=(o=c.data).filter)==null?void 0:l.call(o,i=>i.checked).map(i=>({goods_id:i.goods_options_info.goods_id,count:i.count,cart_id:i.id,goods_options_info:i.goods_options_info,goods_info:i.goods_options_info.goods_info}));n.length>0&&g.push({name:"addressList",query:{orderInfo:btoa(encodeURI(JSON.stringify({goods:n,price:v.value})))}})};return(n,o)=>{var a,d;const l=Be,i=Ge,I=ze,w=Ke,V=Ae,C=Ee,$=Ye,N=Ue,x=Re,L=De,P=We,e=Fe;return y(),z("main",Ze,[m(l,{title:n.$route.meta.title,placeholder:"",fixed:"","left-arrow":"",onClickLeft:o[0]||(o[0]=s=>n.$router.back())},null,8,["title"]),r.value?(y(),z("main",et,[((a=Y(c).data)==null?void 0:a.length)>0?(y(),A(N,{key:0,class:"goods_list","finished-text":"没有更多了",offset:""},{default:b(()=>[(y(!0),z(Ie,null,$e(Y(c).data,s=>(y(),A($,{class:"goods_item"},{right:b(()=>[m(C,{square:"",text:"删除",type:"danger",class:"delete-button",onClick:f=>k(s.id)},null,8,["onClick"])]),default:b(()=>{var f,B,W,ee,te;return[m(i,{class:"selected",modelValue:s.checked,"onUpdate:modelValue":S=>s.checked=S,onSelect:u},null,8,["modelValue","onUpdate:modelValue"]),le("div",tt,[(y(),A(V,{class:"goods_card",onClickThumb:S=>{var D;return h(((D=s.goods_options_info)==null?void 0:D.goods_id)||0)},key:s.id,num:s.count,price:((((f=s.goods_options_info)==null?void 0:f.price)||0)/100*s.count).toFixed(2),desc:((W=(B=s.goods_options_info)==null?void 0:B.goods_info)==null?void 0:W.detail_info)||"",title:((ee=s.goods_options_info)==null?void 0:ee.name)||"未知商品",thumb:((te=s.goods_options_info)==null?void 0:te.pic_url)||""},{tags:b(()=>[m(I,{plain:"",type:"primary"},{default:b(()=>{var S,D;return[H(Ne(((D=(S=s.goods_options_info)==null?void 0:S.goods_info)==null?void 0:D.tags)||""),1)]}),_:2},1024)]),footer:b(()=>[m(w,{onChange:S=>E(s),modelValue:s.count,"onUpdate:modelValue":S=>s.count=S},null,8,["onChange","modelValue","onUpdate:modelValue"])]),_:2},1032,["onClickThumb","num","price","desc","title","thumb"]))])]}),_:2},1024))),256))]),_:1})):(y(),z("div",ot,[m(x,{name:"smile-o",size:"50px"}),o[4]||(o[4]=le("p",{class:"cart_tip"},"购物车空空如也",-1)),m(C,{class:"to_btn",type:"primary",to:"/home"},{default:b(()=>o[3]||(o[3]=[H("去首页")])),_:1})]))])):G("",!0),r.value?G("",!0):(y(),z("div",nt,[m(L,{class:"thumbnail",description:"未登录"},{default:b(()=>[m(C,{type:"primary",class:"login_btn",onClick:o[1]||(o[1]=s=>n.$router.push("/login"))},{default:b(()=>o[5]||(o[5]=[H("登录")])),_:1})]),_:1})])),r.value&&((d=Y(c).data)==null?void 0:d.length)>0?(y(),A(P,{key:2,class:"submit",price:v.value,"button-text":"提交订单",onSubmit:_},{default:b(()=>[m(i,{modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=s=>p.value=s)},{default:b(()=>o[6]||(o[6]=[H("全选")])),_:1},8,["modelValue"])]),_:1},8,["price"])):G("",!0),r.value?(y(),A(e,{key:3,right:"20px",bottom:"4rem"})):G("",!0)])}}},_t=Te(at,[["__scopeId","data-v-29db63b9"]]);export{_t as default};
